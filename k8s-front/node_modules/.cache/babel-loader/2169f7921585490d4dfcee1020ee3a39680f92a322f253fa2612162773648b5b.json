{"ast":null,"code":"const USER_API_BASE_URL = process.env.REACT_APP_USER_API_URL || 'http://localhost:8080';\nconst PROFILE_API_BASE_URL = process.env.REACT_APP_PROFILE_API_URL || 'http://localhost:8081';\n\n// Access Token을 포함한 fetch 요청\nexport const fetchWithAuth = async (url, options = {}) => {\n  const accessToken = localStorage.getItem('accessToken');\n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  if (accessToken) {\n    headers['Authorization'] = `User ${accessToken}`;\n  }\n  try {\n    let response = await fetch(url, {\n      ...options,\n      headers\n    });\n\n    // 401 에러 (토큰 만료) 시 토큰 갱신 시도\n    if (response.status === 401) {\n      const refreshed = await refreshAccessToken();\n      if (refreshed) {\n        // 갱신된 토큰으로 재시도\n        const newAccessToken = localStorage.getItem('accessToken');\n        headers['Authorization'] = `User ${newAccessToken}`;\n        response = await fetch(url, {\n          ...options,\n          headers\n        });\n      } else {\n        // 토큰 갱신 실패 시 로그인 페이지로 이동\n        alert('세션이 만료되었습니다. 다시 로그인해주세요.');\n        localStorage.clear();\n        window.location.href = '/Login';\n        return null;\n      }\n    }\n    return response;\n  } catch (error) {\n    console.error('API 요청 에러:', error);\n    throw error;\n  }\n};\n\n// Refresh Token으로 Access Token 갱신\nexport const refreshAccessToken = async () => {\n  const refreshToken = localStorage.getItem('refreshToken');\n  if (!refreshToken) {\n    return false;\n  }\n  try {\n    const response = await fetch(`${USER_API_BASE_URL}/user/refresh`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `User ${refreshToken}`\n      }\n    });\n    if (response.ok) {\n      const data = await response.json();\n      localStorage.setItem('accessToken', data.accessToken);\n      console.log('Access Token 갱신 성공');\n      return true;\n    } else {\n      console.error('Token 갱신 실패');\n      return false;\n    }\n  } catch (error) {\n    console.error('Token 갱신 에러:', error);\n    return false;\n  }\n};\n\n// 사용자명으로 사용자 ID 조회\nexport const getUserIdByUsername = async username => {\n  try {\n    const response = await fetchWithAuth(`${USER_API_BASE_URL}/user/name/${username}`);\n    if (response && response.ok) {\n      const userId = await response.text();\n      return userId;\n    }\n    return null;\n  } catch (error) {\n    console.error('사용자 ID 조회 에러:', error);\n    return null;\n  }\n};\n\n// ==================== Profile API ====================\n\n// 프로필 생성\nexport const createProfile = async profileData => {\n  try {\n    const response = await fetchWithAuth(`${PROFILE_API_BASE_URL}/profile/create`, {\n      method: 'POST',\n      body: JSON.stringify(profileData)\n    });\n    if (response && response.ok) {\n      return await response.json();\n    } else if (response) {\n      const errorText = await response.text();\n      throw new Error(errorText);\n    }\n    return null;\n  } catch (error) {\n    console.error('프로필 생성 에러:', error);\n    throw error;\n  }\n};\n\n// 모든 프로필 조회\nexport const getAllProfiles = async () => {\n  try {\n    const response = await fetch(`${PROFILE_API_BASE_URL}/profile/all`);\n    if (response.ok) {\n      return await response.json();\n    }\n    return [];\n  } catch (error) {\n    console.error('프로필 목록 조회 에러:', error);\n    return [];\n  }\n};\n\n// 특정 프로필 조회\nexport const getProfileById = async profileId => {\n  try {\n    const response = await fetch(`${PROFILE_API_BASE_URL}/profile/${profileId}`);\n    if (response.ok) {\n      return await response.json();\n    } else if (response.status === 404) {\n      throw new Error('프로필을 찾을 수 없습니다.');\n    }\n    return null;\n  } catch (error) {\n    console.error('프로필 조회 에러:', error);\n    throw error;\n  }\n};\n\n// 프로필 삭제\nexport const deleteProfile = async () => {\n  try {\n    const response = await fetchWithAuth(`${PROFILE_API_BASE_URL}/profile/delete`, {\n      method: 'DELETE'\n    });\n    if (response && response.ok) {\n      const message = await response.text();\n      return message;\n    } else if (response) {\n      const errorText = await response.text();\n      throw new Error(errorText);\n    }\n    return null;\n  } catch (error) {\n    console.error('프로필 삭제 에러:', error);\n    throw error;\n  }\n};\nexport { USER_API_BASE_URL, PROFILE_API_BASE_URL };","map":{"version":3,"names":["USER_API_BASE_URL","process","env","REACT_APP_USER_API_URL","PROFILE_API_BASE_URL","REACT_APP_PROFILE_API_URL","fetchWithAuth","url","options","accessToken","localStorage","getItem","headers","response","fetch","status","refreshed","refreshAccessToken","newAccessToken","alert","clear","window","location","href","error","console","refreshToken","method","ok","data","json","setItem","log","getUserIdByUsername","username","userId","text","createProfile","profileData","body","JSON","stringify","errorText","Error","getAllProfiles","getProfileById","profileId","deleteProfile","message"],"sources":["C:/Users/tlsdm/OneDrive/바탕 화면/k8s-toy-project/src/utils/apiUtils.js"],"sourcesContent":["const USER_API_BASE_URL = process.env.REACT_APP_USER_API_URL || 'http://localhost:8080';\r\nconst PROFILE_API_BASE_URL = process.env.REACT_APP_PROFILE_API_URL || 'http://localhost:8081';\r\n\r\n// Access Token을 포함한 fetch 요청\r\nexport const fetchWithAuth = async (url, options = {}) => {\r\n  const accessToken = localStorage.getItem('accessToken');\r\n  \r\n  const headers = {\r\n    'Content-Type': 'application/json',\r\n    ...options.headers,\r\n  };\r\n\r\n  if (accessToken) {\r\n    headers['Authorization'] = `User ${accessToken}`;\r\n  }\r\n\r\n  try {\r\n    let response = await fetch(url, {\r\n      ...options,\r\n      headers,\r\n    });\r\n\r\n    // 401 에러 (토큰 만료) 시 토큰 갱신 시도\r\n    if (response.status === 401) {\r\n      const refreshed = await refreshAccessToken();\r\n      \r\n      if (refreshed) {\r\n        // 갱신된 토큰으로 재시도\r\n        const newAccessToken = localStorage.getItem('accessToken');\r\n        headers['Authorization'] = `User ${newAccessToken}`;\r\n        \r\n        response = await fetch(url, {\r\n          ...options,\r\n          headers,\r\n        });\r\n      } else {\r\n        // 토큰 갱신 실패 시 로그인 페이지로 이동\r\n        alert('세션이 만료되었습니다. 다시 로그인해주세요.');\r\n        localStorage.clear();\r\n        window.location.href = '/Login';\r\n        return null;\r\n      }\r\n    }\r\n\r\n    return response;\r\n  } catch (error) {\r\n    console.error('API 요청 에러:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Refresh Token으로 Access Token 갱신\r\nexport const refreshAccessToken = async () => {\r\n  const refreshToken = localStorage.getItem('refreshToken');\r\n  \r\n  if (!refreshToken) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`${USER_API_BASE_URL}/user/refresh`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `User ${refreshToken}`,\r\n      },\r\n    });\r\n\r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      localStorage.setItem('accessToken', data.accessToken);\r\n      console.log('Access Token 갱신 성공');\r\n      return true;\r\n    } else {\r\n      console.error('Token 갱신 실패');\r\n      return false;\r\n    }\r\n  } catch (error) {\r\n    console.error('Token 갱신 에러:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// 사용자명으로 사용자 ID 조회\r\nexport const getUserIdByUsername = async (username) => {\r\n  try {\r\n    const response = await fetchWithAuth(`${USER_API_BASE_URL}/user/name/${username}`);\r\n    \r\n    if (response && response.ok) {\r\n      const userId = await response.text();\r\n      return userId;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('사용자 ID 조회 에러:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// ==================== Profile API ====================\r\n\r\n// 프로필 생성\r\nexport const createProfile = async (profileData) => {\r\n  try {\r\n    const response = await fetchWithAuth(`${PROFILE_API_BASE_URL}/profile/create`, {\r\n      method: 'POST',\r\n      body: JSON.stringify(profileData)\r\n    });\r\n\r\n    if (response && response.ok) {\r\n      return await response.json();\r\n    } else if (response) {\r\n      const errorText = await response.text();\r\n      throw new Error(errorText);\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('프로필 생성 에러:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 모든 프로필 조회\r\nexport const getAllProfiles = async () => {\r\n  try {\r\n    const response = await fetch(`${PROFILE_API_BASE_URL}/profile/all`);\r\n    \r\n    if (response.ok) {\r\n      return await response.json();\r\n    }\r\n    return [];\r\n  } catch (error) {\r\n    console.error('프로필 목록 조회 에러:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// 특정 프로필 조회\r\nexport const getProfileById = async (profileId) => {\r\n  try {\r\n    const response = await fetch(`${PROFILE_API_BASE_URL}/profile/${profileId}`);\r\n    \r\n    if (response.ok) {\r\n      return await response.json();\r\n    } else if (response.status === 404) {\r\n      throw new Error('프로필을 찾을 수 없습니다.');\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('프로필 조회 에러:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// 프로필 삭제\r\nexport const deleteProfile = async () => {\r\n  try {\r\n    const response = await fetchWithAuth(`${PROFILE_API_BASE_URL}/profile/delete`, {\r\n      method: 'DELETE'\r\n    });\r\n\r\n    if (response && response.ok) {\r\n      const message = await response.text();\r\n      return message;\r\n    } else if (response) {\r\n      const errorText = await response.text();\r\n      throw new Error(errorText);\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('프로필 삭제 에러:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\nexport { USER_API_BASE_URL, PROFILE_API_BASE_URL };"],"mappings":"AAAA,MAAMA,iBAAiB,GAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,IAAI,uBAAuB;AACvF,MAAMC,oBAAoB,GAAGH,OAAO,CAACC,GAAG,CAACG,yBAAyB,IAAI,uBAAuB;;AAE7F;AACA,OAAO,MAAMC,aAAa,GAAG,MAAAA,CAAOC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,KAAK;EACxD,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EAEvD,MAAMC,OAAO,GAAG;IACd,cAAc,EAAE,kBAAkB;IAClC,GAAGJ,OAAO,CAACI;EACb,CAAC;EAED,IAAIH,WAAW,EAAE;IACfG,OAAO,CAAC,eAAe,CAAC,GAAG,QAAQH,WAAW,EAAE;EAClD;EAEA,IAAI;IACF,IAAII,QAAQ,GAAG,MAAMC,KAAK,CAACP,GAAG,EAAE;MAC9B,GAAGC,OAAO;MACVI;IACF,CAAC,CAAC;;IAEF;IACA,IAAIC,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;MAC3B,MAAMC,SAAS,GAAG,MAAMC,kBAAkB,CAAC,CAAC;MAE5C,IAAID,SAAS,EAAE;QACb;QACA,MAAME,cAAc,GAAGR,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;QAC1DC,OAAO,CAAC,eAAe,CAAC,GAAG,QAAQM,cAAc,EAAE;QAEnDL,QAAQ,GAAG,MAAMC,KAAK,CAACP,GAAG,EAAE;UAC1B,GAAGC,OAAO;UACVI;QACF,CAAC,CAAC;MACJ,CAAC,MAAM;QACL;QACAO,KAAK,CAAC,0BAA0B,CAAC;QACjCT,YAAY,CAACU,KAAK,CAAC,CAAC;QACpBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;QAC/B,OAAO,IAAI;MACb;IACF;IAEA,OAAOV,QAAQ;EACjB,CAAC,CAAC,OAAOW,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK,CAAC;IAClC,MAAMA,KAAK;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAMP,kBAAkB,GAAG,MAAAA,CAAA,KAAY;EAC5C,MAAMS,YAAY,GAAGhB,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;EAEzD,IAAI,CAACe,YAAY,EAAE;IACjB,OAAO,KAAK;EACd;EAEA,IAAI;IACF,MAAMb,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGd,iBAAiB,eAAe,EAAE;MAChE2B,MAAM,EAAE,MAAM;MACdf,OAAO,EAAE;QACP,eAAe,EAAE,QAAQc,YAAY;MACvC;IACF,CAAC,CAAC;IAEF,IAAIb,QAAQ,CAACe,EAAE,EAAE;MACf,MAAMC,IAAI,GAAG,MAAMhB,QAAQ,CAACiB,IAAI,CAAC,CAAC;MAClCpB,YAAY,CAACqB,OAAO,CAAC,aAAa,EAAEF,IAAI,CAACpB,WAAW,CAAC;MACrDgB,OAAO,CAACO,GAAG,CAAC,oBAAoB,CAAC;MACjC,OAAO,IAAI;IACb,CAAC,MAAM;MACLP,OAAO,CAACD,KAAK,CAAC,aAAa,CAAC;MAC5B,OAAO,KAAK;IACd;EACF,CAAC,CAAC,OAAOA,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,cAAc,EAAEA,KAAK,CAAC;IACpC,OAAO,KAAK;EACd;AACF,CAAC;;AAED;AACA,OAAO,MAAMS,mBAAmB,GAAG,MAAOC,QAAQ,IAAK;EACrD,IAAI;IACF,MAAMrB,QAAQ,GAAG,MAAMP,aAAa,CAAC,GAAGN,iBAAiB,cAAckC,QAAQ,EAAE,CAAC;IAElF,IAAIrB,QAAQ,IAAIA,QAAQ,CAACe,EAAE,EAAE;MAC3B,MAAMO,MAAM,GAAG,MAAMtB,QAAQ,CAACuB,IAAI,CAAC,CAAC;MACpC,OAAOD,MAAM;IACf;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOX,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,eAAe,EAAEA,KAAK,CAAC;IACrC,OAAO,IAAI;EACb;AACF,CAAC;;AAED;;AAEA;AACA,OAAO,MAAMa,aAAa,GAAG,MAAOC,WAAW,IAAK;EAClD,IAAI;IACF,MAAMzB,QAAQ,GAAG,MAAMP,aAAa,CAAC,GAAGF,oBAAoB,iBAAiB,EAAE;MAC7EuB,MAAM,EAAE,MAAM;MACdY,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACH,WAAW;IAClC,CAAC,CAAC;IAEF,IAAIzB,QAAQ,IAAIA,QAAQ,CAACe,EAAE,EAAE;MAC3B,OAAO,MAAMf,QAAQ,CAACiB,IAAI,CAAC,CAAC;IAC9B,CAAC,MAAM,IAAIjB,QAAQ,EAAE;MACnB,MAAM6B,SAAS,GAAG,MAAM7B,QAAQ,CAACuB,IAAI,CAAC,CAAC;MACvC,MAAM,IAAIO,KAAK,CAACD,SAAS,CAAC;IAC5B;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOlB,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK,CAAC;IAClC,MAAMA,KAAK;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAMoB,cAAc,GAAG,MAAAA,CAAA,KAAY;EACxC,IAAI;IACF,MAAM/B,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGV,oBAAoB,cAAc,CAAC;IAEnE,IAAIS,QAAQ,CAACe,EAAE,EAAE;MACf,OAAO,MAAMf,QAAQ,CAACiB,IAAI,CAAC,CAAC;IAC9B;IACA,OAAO,EAAE;EACX,CAAC,CAAC,OAAON,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,eAAe,EAAEA,KAAK,CAAC;IACrC,OAAO,EAAE;EACX;AACF,CAAC;;AAED;AACA,OAAO,MAAMqB,cAAc,GAAG,MAAOC,SAAS,IAAK;EACjD,IAAI;IACF,MAAMjC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGV,oBAAoB,YAAY0C,SAAS,EAAE,CAAC;IAE5E,IAAIjC,QAAQ,CAACe,EAAE,EAAE;MACf,OAAO,MAAMf,QAAQ,CAACiB,IAAI,CAAC,CAAC;IAC9B,CAAC,MAAM,IAAIjB,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;MAClC,MAAM,IAAI4B,KAAK,CAAC,iBAAiB,CAAC;IACpC;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOnB,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK,CAAC;IAClC,MAAMA,KAAK;EACb;AACF,CAAC;;AAED;AACA,OAAO,MAAMuB,aAAa,GAAG,MAAAA,CAAA,KAAY;EACvC,IAAI;IACF,MAAMlC,QAAQ,GAAG,MAAMP,aAAa,CAAC,GAAGF,oBAAoB,iBAAiB,EAAE;MAC7EuB,MAAM,EAAE;IACV,CAAC,CAAC;IAEF,IAAId,QAAQ,IAAIA,QAAQ,CAACe,EAAE,EAAE;MAC3B,MAAMoB,OAAO,GAAG,MAAMnC,QAAQ,CAACuB,IAAI,CAAC,CAAC;MACrC,OAAOY,OAAO;IAChB,CAAC,MAAM,IAAInC,QAAQ,EAAE;MACnB,MAAM6B,SAAS,GAAG,MAAM7B,QAAQ,CAACuB,IAAI,CAAC,CAAC;MACvC,MAAM,IAAIO,KAAK,CAACD,SAAS,CAAC;IAC5B;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOlB,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK,CAAC;IAClC,MAAMA,KAAK;EACb;AACF,CAAC;AAGD,SAASxB,iBAAiB,EAAEI,oBAAoB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}